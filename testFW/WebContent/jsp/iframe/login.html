<!DOCTYPE html>
<html>
<head>
<title>登录</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>
<style rel="stylesheet" type="text/css">
#login {
	margin: 0;
	width: 546px;
}

#cap-top {
	background: url("/img/login/cap-top.png") no-repeat scroll 0 0
		transparent;
	height: 8px;
	width: 546px;
}

#cap-body {
	background: url("/img/login/cap-bg.png") repeat-y scroll 0 0 transparent;
	padding-left: 40px;
	padding-right: 40px;
}

.clearfix:after {
	clear: both;
	content: ".";
	display: block;
	height: 0;
	visibility: hidden;
}

div#login div#branding {
	padding-top: 20px;
}

.clearfix {
	display: block;
}

.clearfix {
	display: inline-block;
}

element.style {
	border-width: 0;
	float: left;
	max-height: 60px;
	max-width: 260px;
}

div#login div#branding img {
	display: block;
	margin: 0 0 10px;
}

div#login div#panelLogin div,div#login div#panelResetPass div,div#login div#panelChangePass div,div#login div#registDiv div
	{
	margin: 0 auto;
	padding-bottom: 18px;
	width: 456px;
}

div#login label,.info {
	color: #888888;
	display: block;
	font-size: 13px;
}

div#login input.textbox340 {
	background: none repeat scroll 0 0 #fafafa;
	border: 1px solid #EEEEEE;
	font-size: 18px;
	line-height: 20px;
	margin: 0;
	padding: 3px;
	width: 440px;
}

div#login a:link,div#login a:visited {
	color: #aaaaaa;
}

.buttonLoginV2 {
	background: -moz-linear-gradient(center top, #FFFFFF 5%, #F0F0F0 100%)
		repeat scroll 0 0 #FFFFFF;
	border: 1px solid #D1D1D1;
	border-radius: 16px 16px 16px 16px;
	box-shadow: 0 1px 3px 0 #DEDEDE;
	color: #666666 !important;
	display: inline-block;
	font-family: arial;
	font-size: 14px;
	font-weight: bold;
	padding: 6px 24px;
	text-decoration: none;
	text-shadow: 1px 1px 0 #FFFFFF;
}

#result {
	margin-bottom: 40px;
}

.tip {
	color: red;
}
</style>
<body>
	<script type="text/javascript">
		$(function(){
			var param = location.search;
			if(param=="p=showregist") {
				showRegist();
			}			
		});
		
		$("input").focus(function() {
			$(".tip").text("");
		});
		function showResetPass() {
			$(".tip").text("");
			$("#panelLogin").hide();//隐藏
			$("#panelResetPass").show();//显示
		}
		function showLogin() {
			$(".tip").text("");
			$("#panelLogin").show();
			$("#result").hide();
		}
		function showRegist() {
			$(".tip").text("");
			$("#panelLogin").hide();//隐藏
			$("#panelResetPass").hide();
			$("#registDiv").show();//显示
		}

		function doAct(type) {
			$(".tip").text("");
			if (type == "login") {
				var email = $("#txtEmailLogin").val();
				var pass = $("#txtPasswordLogin").val();
				//非空验证
				if (email == "") {
					$("#email_login_tip").text("邮箱不能为空！");
					return;
				}
				if (pass == "") {
					$("#pass_login_tip").text("密码不能为空！");
					return;
				}
				//验证邮箱格式
				var emailRegExp = new RegExp(
						"[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?");
				if (!emailRegExp.test(email) || email.indexOf('.') == -1) {
					$("#email_login_tip").text("您输入的邮箱格式不正确！");
					return;
				}
				//异步登录
				$.ajax({
					type : "POST",
					url : "/action/user/login",
					data : {
						email : email,
						pass : pass
					},
					dataType : "text",
					success : function(msg) {
						if("email_error" == msg) {
							$("#email_login_tip").text("帐号不存在！");
							return;
						}else if ("success" == msg) {
							parent.location.reload();
							return;
						} else {
							$("#result").text("对不起，登录失败：系统正在维护~");
							showResult();
						}
					}
				});
			} else if (type == "findpass") {
				$.ajax({
					type : "POST",
					url : "/action/user/findpass",
					dataType : "text",
					success : function(msg) {
						if ("success" == msg) {
							$("#result").text("找回密码链接已发送到您邮箱，请登录邮箱查看~");
						} else {
							$("#result").text("对不起,找回失败~");
						}
						showResult();
					}
				});
			} else if (type == "regist") {
				var email = $("#txtEmailAddressRegist").val();
				var name = $("#txtNameRegist").val();
				var pass = $("#txtPasswordRegist").val();
				var pass_con = $("#txtPasswordCon").val();
				var invitationcode = $("#txtInvitationCode").val();
				//非空验证
				if (email == "") {
					$("#email_regist_tip").text("邮箱不能为空！");
					return;
				}
				if (name == "") {
					$("#name_tip").text("昵称不能为空！");
					return;
				}
				if (pass == "") {
					$("#pass_regist_tip").text("密码不能为空！");
					return;
				}
				if (pass_con == "") {
					$("#pass_con_tip").text("确认密码不能为空！");
					return;
				}
				if (invitationcode == "") {
					$("#code_tip").text("邀请码不能为空！");
					return;
				}
				//验证邮箱格式
				var emailRegExp = new RegExp(
						"[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?");
				if (!emailRegExp.test(email) || email.indexOf('.') == -1) {
					$("#email_regist_tip").text("您输入的邮箱格式不正确！");
					return;
				}
				//验证密码
				if (pass != pass_con) {
					$("#pass_con_tip").text("密码不一致！");
					return;
				}
				$
						.ajax({
							type : "POST",
							url : "/action/user/regist",
							data : {
								email : email,
								pass : pass,
								name : name,
								invitationcode : invitationcode
							},
							dataType : "text",
							success : function(msg) {
								if ("code_error" == msg) {
									$("#code_tip").text("邀请码无效！");
									return;
								} else if ("email_error" == msg) {
									$("#email_regist_tip").text("邮箱已经被注册！");
									return;
								} else {
									if ("success" == msg) {
										$("#result")
												.html(
														"恭喜您，注册成功！现在马上&nbsp;<a href='#' onclick='javascript:showLogin();'>登录~</a>");
									} else {
										$("#result").text("对不起，注册失败:系统正在维护中~");
									}
									showResult();
								}
							}
						});
			}
		}
		//显示结果页
		function showResult() {
			$("#panelLogin").hide();
			$("#panelResetPass").hide();
			$("#registDiv").hide();
			$("#result").show();
		}
	</script>
	<div>
		<div id="login">
			<div id="cap-top"></div>
			<div id="cap-body">
				<div class="clearfix" id="branding">
					<img
						style="border-width: 0px; float: left; max-width: 260px; max-height: 60px;"
						src="http://www.wnjava.com/img/logo.png" id="imgLogo">
				</div>
				<div id="panelLogin">
					<div>
						<label>账号(注册邮箱): <span class="tip" id="email_login_tip"></span></label> <input type="text" value=""
							id="txtEmailLogin" name="txtEmailLogin" class="textbox340">
					</div>
					<div>
						<label>密码: <span class="tip" id="pass_login_tip"></span></label> <input type="password" value=""
							autocomplete="off" id="txtPasswordLogin" name="txtPasswordLogin"
							class="textbox340">
					</div>
					<div style="text-align: right;" class="submit clearfix">
						<a href="#" class="buttonLoginV2" id="lbtnLogin"
							onclick="javascript:doAct('login');">LOGIN</a>
					</div>
					<p class="lostpassword">
						<a href="#" onclick="javascript:showResetPass();"> 密码忘记了?</a> or <a
							href="#" onclick="javascript:showRegist();">5秒快速注册?</a>
					</p>
				</div>
				<div id="panelResetPass" style="display: none;">
					<div class="info">输入您注册时候的邮箱，来找回您的密码。</div>
					<div>
						<label> 注册邮箱地址：<span class="tip" id="email_findpass_tip"></span></label> <input type="text" value=""
							id="txtEmailAddressResetPass" name="txtEmailAddressResetPass"
							class="textbox340">
					</div>
					<div style="text-align: right;" class="submit clearfix">
						<a href="#" class="buttonLoginV2" id="lbtnRetrieve"
							onclick="javascript:doAct('findpass');">找回密码</a>
					</div>
				</div>
				<div id="registDiv" style="display: none;">
					<div>
						<label> 注册邮箱：<span class="tip" id="email_regist_tip"></span> </label> <input
							type="text" value="" id="txtEmailAddressRegist"
							name="txtEmailAddressRegist" class="textbox340">
					</div>
					<div>
						<label> 昵称：<span class="tip" id="name_tip"></span> </label> <input
							type="text" value="" id="txtNameRegist" name="txtNameRegist"
							class="textbox340">
					</div>
					<div>
						<label> 密码：<span class="tip" id="pass_regist_tip"></span> </label> <input
							type="password" value="" id="txtPasswordRegist"
							name="txtPasswordRegist" class="textbox340">
					</div>
					<div>
						<label> 确认密码：<span class="tip" id="pass_con_tip"></span> </label>
						<input type="password" value="" id="txtPasswordCon"
							name="txtPasswordCon" class="textbox340">
					</div>
					<div>
						<label> 邀请码：<span class="tip" id="code_tip"></span> </label> <input
							type="text" value="" id="txtInvitationCode"
							name="txtInvitationCode" class="textbox340">
					</div>
					<div style="text-align: right;" class="submit clearfix">
						<a href="#" class="buttonLoginV2" id="lbtnRegist"
							onclick="javascript:doAct('regist');">快速注册</a>
					</div>
				</div>
				<div class="info" id="result" style="display: none;"></div>

			</div>
		</div>
	</div>
</body>
</html>